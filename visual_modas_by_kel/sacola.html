<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="design/icone_visualmodasbykel.png">
    <link href="estilos.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <title>Minha Sacola - Visual Modas By Kel</title>
</head>

<body>

    <!-- Cabeçalho de Checkout Colorido -->
    <div class="checkout-header">
        <div class="checkout-header-content">
            <!-- Logo em Destaque -->
            <div class="checkout-logo-section">
                <a href="home.html" class="checkout-logo">VISUAL MODAS BY KEL</a>
            </div>

            <!-- Etapas Compactas -->
            <nav class="checkout-steps" aria-label="Etapas do checkout">
                <ul class="checkout-steps-list">
                    <li class="checkout-step active">
                        <div class="checkout-step-number">1</div>
                        <span class="checkout-step-label">Sacola</span>
                    </li>
                    <li class="checkout-step">
                        <div class="checkout-step-number">2</div>
                        <span class="checkout-step-label">Identificação</span>
                    </li>
                    <li class="checkout-step">
                        <div class="checkout-step-number">3</div>
                        <span class="checkout-step-label">Entrega</span>
                    </li>
                    <li class="checkout-step">
                        <div class="checkout-step-number">4</div>
                        <span class="checkout-step-label">Pagamento</span>
                    </li>
                    <li class="checkout-step">
                        <div class="checkout-step-number">5</div>
                        <span class="checkout-step-label">Confirmação</span>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <main class="sacola-page">
        <div class="sacola-container">
            <div class="sacola-header">
                <h1 class="sacola-title">Minha Sacola</h1>
                <p class="sacola-subtitle" id="sacolaTotal">0 itens</p>
            </div>

            <div class="sacola-content">
                <!-- Lista de Itens -->
                <div class="sacola-items-wrapper">
                    <!-- Estado Vazio -->
                    <div class="sacola-empty" id="sacolaEmpty">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                            <line x1="3" y1="6" x2="21" y2="6" />
                        </svg>
                        <h2>Sua sacola está vazia</h2>
                        <p>Adicione produtos incríveis e comece a montar seu look!</p>
                        <a href="home.html" class="btn-continuar-comprando">Continuar Comprando</a>
                    </div>

                    <!-- Lista de Produtos -->
                    <div class="sacola-items" id="sacolaItems">
                        <!-- Itens serão carregados via JavaScript -->
                    </div>
                </div>

                <!-- Resumo do Pedido -->
                <div class="sacola-resumo" id="sacolaResumo" style="display: none;">
                    <h2 class="resumo-title">Resumo do Pedido</h2>

                    <div class="resumo-linha">
                        <span>Subtotal</span>
                        <span id="resumoSubtotal">R$ 0,00</span>
                    </div>

                    <div class="resumo-linha">
                        <span>Frete</span>
                        <span id="resumoFrete">A calcular</span>
                    </div>

                    <div class="resumo-linha desconto-linha" id="descontoLinha" style="display: none;">
                        <span>Desconto</span>
                        <span id="resumoDesconto">- R$ 0,00</span>
                    </div>

                    <div class="resumo-linha total">
                        <span>Total</span>
                        <span id="resumoTotal">R$ 0,00</span>
                    </div>

                    <button class="btn-finalizar" onclick="finalizarCompra()">Finalizar Compra</button>

                    <a href="home.html" class="btn-continuar-comprando-sacola">Escolher Mais Produtos</a>

                    <!-- Descomente se quiser usar cupons
                    <div class="cupom-section">
                        <label>Tem um cupom de desconto?</label>
                        <div class="cupom-input-wrapper">
                            <input type="text" id="cupomInput" placeholder="Digite o cupom" maxlength="20">
                            <button class="btn-aplicar-cupom" onclick="aplicarCupom()">Aplicar</button>
                        </div>
                        <div class="cupom-feedback" id="cupomFeedback"></div>
                    </div>
                    -->
                </div>
            </div>
        </div>
    </main>

    <!-- Rodapé -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Institucional</h3>
                    <ul>
                        <li><a href="#">Sobre Nós</a></li>
                        <li><a href="#">Nossa História</a></li>
                        <li><a href="#">Trabalhe Conosco</a></li>
                        <li><a href="#">Lojas Físicas</a></li>
                        <li><a href="#">Política de Privacidade</a></li>
                        <li><a href="#">Termos de Uso</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Contato</h3>
                    <p><strong>Telefone:</strong> (48) 9 9957-5303</p>
                    <p><strong>E-mail:</strong> contato@visualmodasbykel.com.br</p>
                    <p><strong>Horário de Atendimento:</strong><br>
                        Segunda a Sexta: 08h30 às 18h<br>
                        Sábado: 08h30 às 17h</p>
                    <div class="footer-social">
                        <a href="#" title="Instagram" aria-label="Instagram">
                            <img src="design/icone_instagram.png" alt="Instagram">
                        </a>
                        <a href="#" title="Facebook" aria-label="Facebook">
                            <img src="design/icone_facebook.png" alt="Facebook">
                        </a>
                        <a href="#" title="TikTok" aria-label="TikTok">
                            <img src="design/icone_tiktok.png" alt="TikTok">
                        </a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>Formas de Pagamento</h3>
                    <div class="footer-payment">
                        <img src="design/icone_pix.png" alt="Pix" title="Pix">
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Visual Modas By Kel - Todos os direitos reservados</p>
                <p>CNPJ: 00.000.000/0001-00 | Criciúma - SC</p>
                <p>Desenvolvido por <a href="#">Visual Modas By Kel</a></p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Carrega dados do localStorage
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let cupomAplicado = null;
        let descontoAtual = 0;

        // Cupons válidos
        const cupomsValidos = {
            'BEMVINDOVM': { tipo: 'percentual', valor: 10, descricao: '10% de desconto' },
            'PIX5': { tipo: 'percentual', valor: 5, descricao: '5% de desconto no PIX' },
            'FRETEGRATIS': { tipo: 'frete', valor: 0, descricao: 'Frete grátis' }
        };

        // DADOS DOS PRODUTOS (mesmo array da home.html)
        const allProducts = [
            {
                id: 1,
                name: "Vestido Midi Floral",
                price: 899.90,
                installments: 7,
                image1: "design/ex-roupa1.png",
                image2: "design/ex-roupa1b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 2,
                name: "Blusa Cropped Básica",
                price: 449.90,
                installments: 4,
                image1: "design/ex-roupa2.png",
                image2: "design/ex-roupa2b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 3,
                name: "Calça Wide Leg Alfaiataria",
                price: 679.90,
                installments: 5,
                image1: "design/ex-roupa3.png",
                image2: "design/ex-roupa3b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 4,
                name: "Saia Midi Plissada",
                price: 559.90,
                installments: 5,
                image1: "design/ex-roupa4.png",
                image2: "design/ex-roupa4b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 5,
                name: "Shorts Cintura Alta",
                price: 399.90,
                installments: 4,
                image1: "design/ex-roupa5.png",
                image2: "design/ex-roupa5b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 6,
                name: "Jaqueta Jeans Oversized",
                price: 799.90,
                installments: 6,
                image1: "design/ex-roupa6.png",
                image2: "design/ex-roupa6b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 7,
                name: "Macacão Longo Elegante",
                price: 989.90,
                installments: 8,
                image1: "design/ex-roupa7.png",
                image2: "design/ex-roupa7b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 8,
                name: "Blazer Alfaiataria Premium",
                price: 849.90,
                installments: 7,
                image1: "design/ex-roupa8.png",
                image2: "design/ex-roupa8b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 9,
                name: "Body Canelado Básico",
                price: 329.90,
                installments: 3,
                image1: "design/ex-roupa9.png",
                image2: "design/ex-roupa9b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 10,
                name: "Regata Ribana Alongada",
                price: 279.90,
                installments: 3,
                image1: "design/ex-roupa10.png",
                image2: "design/ex-roupa10b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 11,
                name: "Vestido Longo Festa",
                price: 1199.90,
                installments: 10,
                image1: "design/ex-roupa11.png",
                image2: "design/ex-roupa11b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            },
            {
                id: 12,
                name: "Calça Cargo Moderna",
                price: 629.90,
                installments: 5,
                image1: "design/ex-roupa12.png",
                image2: "design/ex-roupa12b.png",
                sizes: ["PP", "P", "M", "G", "GG"]
            }
        ];

        // Tamanhos disponíveis
        const availableSizes = ["PP", "P", "M", "G", "GG"];

        function loadCart() {
            const itemsWrapper = document.getElementById('sacolaItems');
            const emptyState = document.getElementById('sacolaEmpty');
            const resumo = document.getElementById('sacolaResumo');
            const totalElement = document.getElementById('sacolaTotal');
            const sacolaContent = document.querySelector('.sacola-content');

            if (cart.length === 0) {
                emptyState.style.display = 'flex';
                itemsWrapper.style.display = 'none';
                resumo.style.display = 'none';
                totalElement.textContent = '0 itens';
                // Adiciona classe para centralizar (fallback para navegadores sem :has())
                if (sacolaContent) {
                    sacolaContent.classList.add('sacola-vazia');
                }
            } else {
                emptyState.style.display = 'none';
                itemsWrapper.style.display = 'block';
                resumo.style.display = 'block';

                const totalItens = cart.reduce((sum, item) => sum + item.quantity, 0);
                totalElement.textContent = `${totalItens} ${totalItens === 1 ? 'item' : 'itens'}`;

                itemsWrapper.innerHTML = cart.map(item => createCartItem(item)).join('');
                updateResumo();
                
                // Remove classe quando há itens
                if (sacolaContent) {
                    sacolaContent.classList.remove('sacola-vazia');
                }
            }

            updateFavoritesCount();
            updateCartCount();
        }

        function createCartItem(item) {
            // Busca os dados completos do produto
            const productData = allProducts.find(p => p.id === item.id);

            // Se não encontrar, usa os dados do localStorage
            const productName = item.name || (productData ? productData.name : 'Produto');
            const productPrice = item.price || (productData ? productData.price : 0);
            const productImage = item.image || (productData ? productData.image1 : 'design/placeholder.png');

            return `
        <div class="sacola-item" data-item-id="${item.id}-${item.size}">
            <div class="item-image">
                <img src="${productImage}" alt="${productName}">
            </div>
            <div class="item-details">
                <h3 class="item-name">${productName}</h3>
                
                <!-- Seletor de Tamanho -->
                <div class="item-size-selector">
                    <span>Tamanho:</span>
                    <div class="size-select-wrapper">
                        <select class="size-select" onchange="changeItemSize(${item.id}, '${item.size}', this.value)">
                            ${generateSizeOptions(item.id, item.size)}
                        </select>
                    </div>
                </div>
                
                <div class="size-change-alert" id="alert-${item.id}-${item.size}">
                    Tamanho alterado com sucesso!
                </div>
                
                <p class="item-price">R$ ${productPrice.toFixed(2).replace('.', ',')}</p>
                
                <div class="item-actions">
                    <div class="quantity-control">
                        <button class="btn-qty" onclick="updateQuantity(${item.id}, '${item.size}', -1)">−</button>
                        <span class="qty-value">${item.quantity}</span>
                        <button class="btn-qty" onclick="updateQuantity(${item.id}, '${item.size}', 1)">+</button>
                    </div>
                    <button class="btn-remove" onclick="removeFromCart(${item.id}, '${item.size}')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Remover
                    </button>
                </div>
            </div>
            <div class="item-total">
                <span class="item-total-label">Total</span>
                <span class="item-total-value">R$ ${(productPrice * item.quantity).toFixed(2).replace('.', ',')}</span>
            </div>
        </div>
    `;
        }

        function generateSizeOptions(productId, currentSize) {
            return availableSizes.map(size => {
                const selected = size === currentSize ? 'selected' : '';
                return `<option value="${size}" ${selected}>${size}</option>`;
            }).join('');
        }

        function changeItemSize(productId, oldSize, newSize) {
            if (oldSize === newSize) return;

            const currentItem = cart.find(item => item.id === productId && item.size === oldSize);
            if (!currentItem) return;

            const existingItem = cart.find(item => item.id === productId && item.size === newSize);

            if (existingItem) {
                existingItem.quantity += currentItem.quantity;
                cart = cart.filter(item => !(item.id === productId && item.size === oldSize));
                showNotification(`Tamanho alterado! Quantidade do tamanho ${newSize} atualizada.`);
            } else {
                currentItem.size = newSize;
                showNotification(`Tamanho alterado de ${oldSize} para ${newSize}!`);
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }

        function updateQuantity(productId, size, change) {
            const item = cart.find(i => i.id === productId && i.size === size);
            if (!item) return;

            item.quantity += change;

            if (item.quantity <= 0) {
                removeFromCart(productId, size);
                return;
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }

        function removeFromCart(productId, size) {
            cart = cart.filter(item => !(item.id === productId && item.size === size));
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            showNotification('Produto removido da sacola');
        }

        function updateResumo() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let desconto = 0;

            if (cupomAplicado) {
                const cupom = cupomsValidos[cupomAplicado];
                if (cupom.tipo === 'percentual') {
                    desconto = subtotal * (cupom.valor / 100);
                }
            }

            descontoAtual = desconto;
            const total = subtotal - desconto;

            document.getElementById('resumoSubtotal').textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
            document.getElementById('resumoTotal').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;

            if (desconto > 0) {
                document.getElementById('descontoLinha').style.display = 'flex';
                document.getElementById('resumoDesconto').textContent = `- R$ ${desconto.toFixed(2).replace('.', ',')}`;
            } else {
                document.getElementById('descontoLinha').style.display = 'none';
            }

            // Frete grátis acima de R$ 500
            const freteElement = document.getElementById('resumoFrete');
            if (subtotal >= 500) {
                freteElement.textContent = 'GRÁTIS';
                freteElement.style.color = '#28a745';
                freteElement.style.fontWeight = '700';
            } else {
                freteElement.textContent = 'A calcular';
                freteElement.style.color = '';
                freteElement.style.fontWeight = '';
            }
        }

        function aplicarCupom() {
            const input = document.getElementById('cupomInput');
            const cupom = input.value.trim().toUpperCase();
            const feedback = document.getElementById('cupomFeedback');

            if (!cupom) {
                feedback.textContent = 'Digite um cupom válido';
                feedback.className = 'cupom-feedback error';
                feedback.style.display = 'block';
                return;
            }

            if (cupomsValidos[cupom]) {
                cupomAplicado = cupom;
                const cupomData = cupomsValidos[cupom];
                feedback.textContent = `Cupom aplicado! ${cupomData.descricao}`;
                feedback.className = 'cupom-feedback success';
                feedback.style.display = 'block';
                input.value = '';
                updateResumo();
                showNotification('Cupom aplicado com sucesso!');
            } else {
                feedback.textContent = 'Cupom inválido ou expirado';
                feedback.className = 'cupom-feedback error';
                feedback.style.display = 'block';
            }
        }

        function finalizarCompra() {
            if (cart.length === 0) {
                showNotification('Adicione produtos à sacola primeiro!');
                return;
            }

            // Redireciona para o checkout
            window.location.href = 'checkout.html';
        }

        function updateFavoritesCount() {
            const count = document.getElementById('favoritosCount');
            if (favorites.length > 0) {
                count.textContent = favorites.length;
                count.style.display = 'inline';
            } else {
                count.style.display = 'none';
            }
        }

        function updateCartCount() {
            const count = document.getElementById('sacolaCount');
            const total = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (total > 0) {
                count.textContent = total;
                count.style.display = 'inline';
            } else {
                count.style.display = 'none';
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: #370400;
                color: white;
                padding: 15px 25px;
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadCart();
        });
    </script>
</body>

</html>